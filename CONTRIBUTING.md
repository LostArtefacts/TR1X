# Development guidelines

## Workflow

First we need to compile the project (how to do this is described in the next
section). After this, there should be `Tomb1Main.dll` output DLL. If you're
doing it for the first time, please copy the output DLL to the directory with
TombATI along with the entire `cfg/` directory. For the subsequent times, only
copy `Tomb1Main.dll`. It is encouraged to create a script that does it for you,
for example on Windows:

`test.bat`:

```
cd "C:\path to your game"
del Tomb1Main.dll
cp "C:\path to the repository\build\Tomb1Main.dll" Tomb1Main.dll
TombATI.exe
```

and on Linux:

`test`:

```
#!/bin/sh
cp /path/to/compiled/Tomb1Main.dll /path/to/your/game/Tomb1Main.dll
wine /path/to/your/game/TombATI.exe
```

## Compiling on Ubuntu

- **With Docker**:

    Make sure to install Docker and make, then run `make docker_build`.
    The DLL should appear in the `build/` directory.

- **Without docker**:

    Install dependencies:

    - `sudo apt-get install -y gcc-mingw-w64-i686`
    - `sudo apt-get install -y make`
    - `sudo apt-get install -y git`
    - `sudo apt-get install -y python3`
    - `sudo apt-get install -y python3-pip`
    - `python3 -m pip install --user pyjson5`

    Then for a clean build, run:

    - `make clean build`

    For a debug build, run:

    - `make clean debug`

    For incremental builds remove `clean` from the above.
    The DLL should appear in the `build/` directory.

## Compiling on Windows

- **Using WSL**:

    Install WSL (video guide: https://www.youtube.com/watch?v=5RTSlby-l9w)

    - Run Powershell as Administrator
    - Copy and paste the following command: `Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux`
    - Restart the computer
    - Go to Windows App Store
    - Install Ubuntu

    Run WSL and continue with the instructions from the `Compiling on Ubuntu` section.

- **Using Visual Studio**:

    **TBD**

## Decompilation guidelines

Each function should be ported in a separate commit. After porting each
function, please update the progress map by editing the `docs/progress.txt`
file and executing `make docs`.

## Autogenerated parts

Parts of the code are autogenerated. To make sure they stay up to date, please
run `make autogenerated`. If for some reason you can't run it, don't worry, our
CI pipeline will show you what need to be changed in case of mistakes.

## Code formatting

This project uses `clang-format` to take care of automatic code formatting. To
ensure your code conforms to the standard, please run `make lint` after each
commit. If for some reason you can't run it, don't worry, our CI pipeline will
show you what need to be changed in case of mistakes.

## Branching

We commit via pull requests and avoid committing directly to master, which is
a protected branch. Each pull request should have at least one approval before
merging. We never merge until all discussions are marked as resolved and
generally try to test things before merging. When a remark on the code review
is trivial and the PR author has pushed a fix for it, it should be resolved by
the pull request author. Otherwise we don't mark the discussions as resolved
and give a chance for the reviewer to reply. Once all change requests are
addressed, we should re-request a review from the interested parties.

## New version releases

New version releases happen automatically whenever a new tag is pushed to the
`master` branch with the help of GitHub actions.
